<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Profile â€“ GamiCon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        body { font-family: 'Poppins', sans-serif; background-color: #111827; }
        .profile-card {
            background-color: #1f2937;
            border: 4px solid #4b5563;
        }

        /* Typography Hierarchy with the retro font */
        .profile-username { font-family: 'Poppins', sans-serif; font-weight: 700; }
        .section-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            color: #9ca3af;
        }
        
        /* --- STANDARD: The "8-bit" Button Style --- */
        .btn-8bit {
            display: inline-block;
            text-align: center;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 8px; 
            border: 4px solid #111827;
            text-transform: uppercase;
            transition: all 0.15s ease-in-out;
            cursor: pointer;
        }
        .btn-8bit:hover {
            transform: translate(-3px, -3px);
            box-shadow: 4px 4px 0px #111827;
        }
        .btn-8bit:active {
            transform: translate(0, 0);
            box-shadow: none;
        }
        
        /* Button color variations */
        .btn-blue { background-color: #2563eb; color: white; }
        .btn-green { background-color: #16a34a; color: white; }
        .btn-gray { background-color: #4b5563; color: white; }
        .btn-blue:hover { box-shadow: 4px 4px 0px #1d4ed8; }
        .btn-green:hover { box-shadow: 4px 4px 0px #15803d; }
        .btn-gray:hover { box-shadow: 4px 4px 0px #374151; }
        
        /* --- UPDATED: Square Trait Pill/Tag styles --- */
        .trait-pill { 
            display: inline-block; 
            padding: 0.4rem 0.9rem; /* Slightly adjusted padding for square look */
            font-weight: 600; 
            font-size: 0.8rem;
            border-radius: 0; /* Changed from 9999px to 0 for a square box */
        }
        .trait-tag {
            display: inline-block; 
            background-color: #1f2937; 
            border: 2px solid #4b5563;
            color: #d1d5db; 
            padding: 0.5rem 1rem; 
            font-size: 0.875rem;
            cursor: pointer; 
            transition: all 0.2s ease-in-out; 
            user-select: none; 
            border-radius: 0; /* Changed from 6px to 0 for a square box */
        }
        .trait-tag:hover { border-color: #6b7280; background-color: #4b5563; color: white; }

        /* Active states now also use the square box style */
        .trait-tag.active-games { background-color: #3b82f6; color: white; border-color: #93c5fd; }
        .trait-tag.active-vibe { background-color: #22c55e; color: white; border-color: #86efac; }
        .trait-tag.active-hours { background-color: #f59e0b; color: #111827; border-color: #fcd34d; }
        .trait-tag.active-comm { background-color: #ef4444; color: white; border-color: #fca5a5; }

        .error-message { color: #ff5555; font-size: 0.8rem; font-weight: 600; }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">
    <div class="min-h-screen flex items-center justify-center p-4">
        <div id="profile-container" class="max-w-3xl w-full">
            <!-- The entire profile card will be dynamically rendered here -->
        </div>
    </div>

    <!-- translation.js and your main script remains the same -->
    <script src="translation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const profileContainer = document.getElementById('profile-container');
            let isEditMode = false;

            const ALL_TRAITS = {
                games: ["traitTagMoba", "traitTagFps", "traitTagRpg", "traitTagStrategy", "traitTagSandbox", "traitTagHorror"],
                vibe: ["traitTagCasual", "traitTagCompetitive", "traitTagTryhard", "traitTagChill", "traitTagFunny", "traitTagFocused"],
                hours: ["traitTagWeekdays", "traitTagWeekends", "traitTagLateNight", "traitTagMornings", "traitTagAnytime"],
                comm: ["traitTagVoice", "traitTagPings", "traitTagText", "traitTagQuiet"]
            };
            
            const CATEGORY_MAP = {
                games: { title: "Game Genres", color: "bg-blue-500 text-white" },
                vibe: { title: "Player Vibe", color: "bg-green-500 text-white" },
                hours: { title: "Active Hours", color: "bg-amber-500 text-gray-900" },
                comm: { title: "Communication", color: "bg-red-500 text-white" }
            };

            const renderDnaCategory = (category, userTraits) => {
                const details = CATEGORY_MAP[category];
                let dnaHTML = `<div class="space-y-3">`; 
                
                if (isEditMode) {
                    dnaHTML += `<h3 class="section-title">${details.title}</h3>`;
                    dnaHTML += `<div class="flex flex-wrap gap-2">`;
                    ALL_TRAITS[category].forEach(traitKey => {
                        const traitText = translations[traitKey] ? (translations[traitKey][localStorage.getItem('gamicon_lang') || 'en']) : traitKey;
                        const isActive = userTraits[category]?.includes(traitText);
                        dnaHTML += `<div class="trait-tag ${isActive ? `active-${category}` : ''}" data-category="${category}">${traitText}</div>`;
                    });
                    dnaHTML += `</div><span id="${category}-error" class="error-message block h-4 mt-1"></span>`;
                } else {
                    if (userTraits[category] && userTraits[category].length > 0) {
                        dnaHTML += `<h3 class="section-title">${details.title}</h3><div class="flex flex-wrap gap-2">`;
                        userTraits[category].forEach(trait => {
                            dnaHTML += `<span class="trait-pill ${details.color}">${trait}</span>`;
                        });
                        dnaHTML += `</div>`;
                    }
                }
                dnaHTML += '</div>';
                return dnaHTML;
            };

            function renderProfile() {
                const profile = JSON.parse(localStorage.getItem('userProfile'));
                const lang = localStorage.getItem('gamicon_lang') || 'en';

                if (!profile) {
                    profileContainer.innerHTML = `<div class="profile-card p-8 text-center rounded-lg"><h1 class="text-2xl mb-4">Profile Not Found</h1><p class="text-gray-400 mb-8">You haven't created a profile yet.</p><a href="index2.html?action=signup" class="btn-8bit btn-blue">Create Profile</a></div>`;
                    return;
                }
                
                const renderButtons = () => {
                    if (isEditMode) {
                        return `<a href="#" id="cancel-btn" class="btn-8bit btn-gray w-full md:w-auto">Cancel</a>
                                <a href="#" id="save-btn" class="btn-8bit btn-green w-full md:w-auto">Save Changes</a>`;
                    } else {
                        return `<a href="main1.html" class="btn-8bit btn-gray w-full md:w-auto">Back</a>
                                <a href="#" id="edit-btn" class="btn-8bit btn-blue w-full md:w-auto">Edit</a>`;
                    }
                };
                
                const profileHTML = `
                    <div class="profile-card p-6 md:p-8 rounded-xl">
                        <!-- Header -->
                        <div class="text-center mb-8">
                            <img src="https://i.pravatar.cc/120?u=${profile.username || 'default'}" alt="Avatar" class="w-28 h-28 rounded-full mx-auto border-4 border-gray-600 mb-4 ring-4 ring-gray-700">
                            <h1 class="profile-username text-3xl">${profile.username || 'N/A'}</h1>
                            <p class="text-gray-400 text-sm">${profile.email || 'N/A'}</p>
                        </div>
                        <hr class="border-gray-700 my-6">

                        <!-- Main Content Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
                            <!-- Left Column -->
                            <div class="space-y-8">
                                <div class="grid grid-cols-2 gap-4">
                                     <div><h3 class="section-title mb-2">Birthday</h3><p class="font-semibold text-lg">${profile.birthday || 'N/A'}</p></div>
                                     <div><h3 class="section-title mb-2">Gender</h3><p class="font-semibold text-lg capitalize">${profile.gender || 'N/A'}</p></div>
                                </div>
                                <hr class="border-gray-700 md:hidden">
                                ${renderDnaCategory('hours', profile.traits || {})}
                                ${renderDnaCategory('comm', profile.traits || {})}
                            </div>
                            
                            <!-- Right Column -->
                             <div class="space-y-8">
                                ${renderDnaCategory('games', profile.traits || {})}
                                ${renderDnaCategory('vibe', profile.traits || {})}
                             </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="mt-6 flex flex-col-reverse md:flex-row gap-4 justify-end">${renderButtons()}</div>
                `;
                
                profileContainer.innerHTML = profileHTML;
            }

            // The rest of your Javascript logic remains exactly the same as it was already working perfectly.
            profileContainer.addEventListener('click', (event) => {
                const target = event.target;
                
                if (target.matches('#edit-btn')) { event.preventDefault(); isEditMode = true; renderProfile(); }
                if (target.matches('#cancel-btn')) { event.preventDefault(); isEditMode = false; renderProfile(); }
                
                if (target.matches('#save-btn')) {
                    event.preventDefault();
                    document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
                    let isValid = true;
                    const lang = localStorage.getItem('gamicon_lang') || 'en';

                    for (const cat in CATEGORY_MAP) {
                        const count = document.querySelectorAll(`.trait-tag[data-category="${cat}"].active-${cat}`).length;
                        const errorEl = document.getElementById(`${cat}-error`);
                        
                        if (count === 0) {
                            errorEl.textContent = (cat === 'comm') ? translations.errorPick1[lang] : translations.errorPickAtLeast1[lang];
                            isValid = false;
                        }
                    }

                    if (isValid) {
                        let profile = JSON.parse(localStorage.getItem('userProfile'));
                        profile.traits = { games: [], vibe: [], hours: [], comm: [] };
                        document.querySelectorAll('.trait-tag[class*="active-"]').forEach(tag => {
                            profile.traits[tag.dataset.category].push(tag.textContent);
                        });
                        localStorage.setItem('userProfile', JSON.stringify(profile));
                        
                        isEditMode = false;
                        renderProfile();
                    }
                }

                if (isEditMode && target.classList.contains('trait-tag')) {
                    const category = target.dataset.category;
                    const activeClass = `active-${category}`;
                    const isActive = target.classList.contains(activeClass);
                    const getActiveCount = () => document.querySelectorAll(`.trait-tag[data-category="${category}"].${activeClass}`).length;

                    if (isActive) {
                        target.classList.remove(activeClass);
                    } else {
                        if (category === 'vibe' && getActiveCount() >= 2) return;
                        if (category === 'hours' && getActiveCount() >= 2) return;
                        if (category === 'comm') {
                            document.querySelectorAll(`.trait-tag[data-category="comm"]`).forEach(t => t.classList.remove('active-comm'));
                        }
                        target.classList.add(activeClass);
                    }
                }
            });

            // Initial render
            renderProfile();
        });
    </script>
</body>
</html>
